<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hangman Game</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="hangnam.css">
</head>
<body>
  <div id="wrapper">
    <div class="card">
      <div id="start-page">
        <h1>Hangman Game</h1>
        <label>Enter Your Name: <input type="text" id="playerName" required></label><br><br>
        <label>Choose Level:
          <select id="difficulty">
            <option value="Easy">Easy</option>
            <option value="Medium">Medium</option>
            <option value="Hard">Hard</option>
          </select>
        </label><br><br>
        <button onclick="startGame()">Start Game</button>
        <p class="highScore">High Score: <span id="highScore">0</span></p>
      </div>

      <div id="game-page" class="hidden">
        <div class="scoreboard">
          <p>Score: <span id="score">0</span> | High Score: <span id="highScoreInGame">0</span></p>
          <p>Level: <span id="currentLevel">Easy</span></p>
        </div>
        <img id="mainImage" src="../hangman/img/stickman.jpg" alt="Hangman Image" width="200">
        <h1>HANGMAN</h1>
        <p id="question"></p>
        <h2 id="wordDisplay"></h2>
        <p id="guess">Guesses: <span id="guesses">0</span>/6</p>
        <div class="keyboard" id="keyboard"></div>
        <button onclick="endGame()">End Game</button>
      </div>
    </div>
  </div>

  <div id="customAlert" role="alert">ðŸŽ‰ Congratulations! You scored the highest! ðŸŽ‰</div>
  <audio id="congratsSound" src="../hangman/sound/applause-sound.mp3" preload="auto"></audio>

  <script>
    let selectedWord = "", question = "";
    let score = 0, highScore = 0, guesses = 0, guessedLetters = [], maxGuesses = 6, currentDifficulty = "Easy";

    function startGame() {
      const name = document.getElementById('playerName').value.trim();
      if (!name) return alert("Name is required!");

      currentDifficulty = document.getElementById('difficulty').value;
      document.getElementById('start-page').classList.add('hidden');
      document.getElementById('game-page').classList.remove('hidden');
      document.getElementById("currentLevel").innerText = currentDifficulty;

      score = 0;
      highScore = parseInt(localStorage.getItem("hangmanHighScore")) || 0;
      document.getElementById("score").innerText = score;
      document.getElementById("highScore").innerText = highScore;
      document.getElementById("highScoreInGame").innerText = highScore;

      loadNewWord();
    }

    async function loadNewWord() {
      let numLetters = currentDifficulty === "Easy" ? 4 : currentDifficulty === "Medium" ? 6 : 10;
// Call listing api to fetch all categories
//Pick a random category

// Use that to set the following category variable

      let category = "food"; 
      let apiUrl = `https://www.wordgamedb.com/api/v1/words/?category=${category}&numLetters=${numLetters}`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        if (!data || !data.length) {
          alert("Not data found.");
          return;
        }

        const randomWordData = data[Math.floor(Math.random() * data.length)];
        selectedWord = randomWordData.word.toLowerCase();
        question = randomWordData.question || "Guess the word:";

        guessedLetters = [];
        guesses = 0;

        document.getElementById("question").textContent = question;
        document.getElementById("guesses").textContent = guesses;
        updateWordDisplay();
        updateKeyboard();
        updateImage();
      } catch (error) {
        console.error("Error fetching word:", error);
        alert("Failed to fetch word from API.");
      }
    }

    function updateWordDisplay() {
      let display = "";
      for (let char of selectedWord) {
        display += guessedLetters.includes(char) ? char + " " : "_ ";
      }
      document.getElementById("wordDisplay").textContent = display.trim();
    }

    document.addEventListener("keydown", function(event) {
      const letter = event.key?.toLowerCase();
      if (/^[a-z]$/.test(letter) && !guessedLetters.includes(letter) && guesses < maxGuesses) {
        handleLetterClick(letter);
      }
    });

    function updateKeyboard() {
      const keyboard = document.getElementById("keyboard");
      keyboard.innerHTML = '';
      for (let i = 65; i <= 90; i++) {
        const char = String.fromCharCode(i).toLowerCase();
        const btn = document.createElement("button");
        btn.textContent = char.toUpperCase();
        btn.id = char;
        btn.disabled = guessedLetters.includes(char) || guesses >= maxGuesses;
        btn.onclick = () => handleLetterClick(char);
        keyboard.appendChild(btn);
      }
    }

    function handleLetterClick(letter) {
      if (guessedLetters.includes(letter)) return;

      guessedLetters.push(letter);
      document.getElementById(letter).disabled = true;

      if (selectedWord.includes(letter)) {
        updateWordDisplay();
        if (isWordGuessed()) {
          score += 5;
          const wasHighScore = score > highScore;
          updateScore();

          if (wasHighScore) {
            showCustomAlert();
            playCongratsSound();
            burstEmojis();
          }

          setTimeout(loadNewWord, 1000);
        }
      } else {
        guesses++;
        document.getElementById("guesses").textContent = guesses;
        updateImage();
        if (guesses >= maxGuesses) {
          alert("Game Over! The word was: " + selectedWord);
          endGame();
        }
      }

      updateKeyboard();
    }

    function isWordGuessed() {
      return [...selectedWord].every(char => guessedLetters.includes(char));
    }

    function updateScore() {
      document.getElementById("score").textContent = score;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem("hangmanHighScore", score);
        document.getElementById("highScore").textContent = score;
        document.getElementById("highScoreInGame").textContent = score;
      }
    }

    function updateImage() {
      const image = document.getElementById("mainImage");
      image.src = `../hangman/img/stickman${guesses === 0 ? "" : "-" + guesses}.jpg`;
    }

    function showCustomAlert() {
      const alertBox = document.getElementById("customAlert");
      alertBox.style.display = "block";
      setTimeout(() => {
        alertBox.style.display = "none";
      }, 2000);
    }

    function playCongratsSound() {
      const audio = document.getElementById("congratsSound");
      audio.currentTime = 0;
      audio.play();
    }

    function burstEmojis() {
      for (let i = 0; i < 10; i++) {
        createEmoji("ðŸŽ‰", "left");
        createEmoji("ðŸŽŠ", "right");
      }
    }

    function createEmoji(char, side) {
      const emoji = document.createElement("div");
      emoji.classList.add("emoji");
      emoji.textContent = char;
      emoji.style.left = side === "left" ? "0px" : "calc(100% - 30px)";
      emoji.style.bottom = "0px";
      document.body.appendChild(emoji);
      setTimeout(() => emoji.remove(), 2000);
    }

    function endGame() {
      document.getElementById("start-page").classList.remove("hidden");
      document.getElementById("game-page").classList.add("hidden");
    }
  </script>
</body>
</html>
